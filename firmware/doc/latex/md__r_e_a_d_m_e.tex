
\begin{DoxyCode}{0}
\DoxyCodeLine{\ \{NOP100.cpp```\}}
\DoxyCodeLine{complete,\ runnable,\ extensible\ firmware\ for}
\DoxyCodeLine{[NOP100-\/based\ hardware](../hardware/README.md).}
\DoxyCodeLine{}
\DoxyCodeLine{The\ NOP100\ build\ framework\ consists\ of\ six\ C++\ source\ files:}
\DoxyCodeLine{```NOP100.cpp```,}
\DoxyCodeLine{```module-\/libraries.inc```,}
\DoxyCodeLine{```module-\/directives.inc```,}
\DoxyCodeLine{```module-\/definitions.inc```,}
\DoxyCodeLine{```module-\/setup.inc```\ and}
\DoxyCodeLine{```module-\/loop.inc```.}
\DoxyCodeLine{Firmware\ for\ a\ specialised\ NMEA\ application\ is\ implemented\ by}
\DoxyCodeLine{extending\ and\ modifying\ the\ ```.inc```\ files\ to\ suit\ the\ requirements}
\DoxyCodeLine{of\ the\ project\ in\ hand.}
\DoxyCodeLine{Each\ ```.inc```\ file\ includes\ documentary\ comments\ which\ explain}
\DoxyCodeLine{how\ to\ structure\ a\ specialisation\ and\ the}
\DoxyCodeLine{[SIM108\ -\/\ NMEA\ 2000\ switch\ input\ module](https://github.com/preeve9534/SIM108/)}
\DoxyCodeLine{project\ is\ based\ on\ NOP100\ and\ gives\ a\ working\ example\ of\ a\ real-\/world}
\DoxyCodeLine{application\ built\ on\ top\ of\ NOP100.}
\DoxyCodeLine{}
\DoxyCodeLine{If\ compiled\ and\ installed\ on\ NOP100\ hardware\ the\ vanilla\ firmware}
\DoxyCodeLine{will\ create\ an\ NMEA\ 2000\ device\ with\ Class\ Code\ 10\ (System\ Tools)}
\DoxyCodeLine{and\ Function\ Code\ 130\ (Diagnostic).}
\DoxyCodeLine{The\ firmware\ supports\ the\ entry\ of\ configuration\ data\ (see\ below),}
\DoxyCodeLine{but\ only\ the\ configuration\ data\ item\ that\ is\ used\ by\ NOP100\ is\ the}
\DoxyCodeLine{module\ instance\ setting.}
\DoxyCodeLine{}
\DoxyCodeLine{\#\#\ Module\ configuration}
\DoxyCodeLine{}
\DoxyCodeLine{NOP100\ treats\ persistent\ configuration\ data\ as\ a\ simple\ byte\ array\ and}
\DoxyCodeLine{provides\ a\ user\ interface\ which\ allows\ the\ hardware\ DIL\ switch\ to\ be\ \ }
\DoxyCodeLine{used\ sequentially\ to\ specify\ a\ storage\ address\ and\ the\ value\ to\ be}
\DoxyCodeLine{stored\ at\ that\ address.}
\DoxyCodeLine{This\ restricts\ the\ configuration\ data\ cache\ to\ a\ size\ of\ 256\ bytes\ with}
\DoxyCodeLine{254\ bytes\ available\ to\ the\ application.}
\DoxyCodeLine{The\ Teensy\ microcontroller\ has\ a\ about\ 1KB\ of\ EEPROM\ available\ and\ if}
\DoxyCodeLine{you\ want\ to\ access\ more\ than\ 256\ bytes\ of\ this\ storage\ then\ you\ will}
\DoxyCodeLine{need\ to\ override\ NOP100's\ simple\ configuration\ model\ with\ a\ more}
\DoxyCodeLine{elaborate\ one\ of\ your\ own.}
\DoxyCodeLine{If\ you\ do\ this,\ make\ sure\ that\ your\ application\ configuration\ data}
\DoxyCodeLine{leaves\ address\ locations\ 0\ and\ 1\ for\ use\ by\ NOP100.}
\DoxyCodeLine{}
\DoxyCodeLine{|\ Address\ |\ Saved\ value\ |}
\DoxyCodeLine{|\ -\/-\/-\/:\ \ \ \ |\ :-\/-\/-\/\ \ \ \ \ \ \ \ |}
\DoxyCodeLine{|\ 0\ \ \ \ \ \ \ |\ CAN\ source\ address.\ Not\ available\ for\ application\ use.\ |}
\DoxyCodeLine{|\ 1\ \ \ \ \ \ \ |\ Module\ instance\ number.\ Not\ available\ for\ application\ use.\ |}
\DoxyCodeLine{|\ 2...\ \ \ \ |\ Available\ for\ application\ use.\ |}
\DoxyCodeLine{}
\DoxyCodeLine{Entry\ of\ configuration\ data\ into\ NOP100\ requires\ a\ value\ to\ be\ set\ on}
\DoxyCodeLine{the\ PCB's\ DIL\ switch\ and\ then\ confirmed\ by\ press\ and\ release\ of\ the\ PRG}
\DoxyCodeLine{button.}
\DoxyCodeLine{A\ short\ press\ of\ PRG\ signifies\ the\ entry\ of\ a\ data\ value;\ a\ long\ press}
\DoxyCodeLine{of\ PRG\ signifies\ entry\ of\ an\ address\ and,\ in\ this\ latter\ case,\ the}
\DoxyCodeLine{expectation\ is\ that\ address\ entry\ will\ promptly\ be\ followed\ by\ the}
\DoxyCodeLine{entry\ of\ a\ data\ value\ which\ should\ be\ stored\ at\ the\ pre-\/set\ address.}
\DoxyCodeLine{}
\DoxyCodeLine{If\ a\ value\ is\ entered\ without\ a\ preceeding\ address\ then\ the\ entered}
\DoxyCodeLine{value\ is\ stored\ at\ address\ 1\ and\ will\ become\ the\ module's\ new\ instance}
\DoxyCodeLine{number.}
\DoxyCodeLine{}
\DoxyCodeLine{Storage\ locations\ with\ an\ address\ greater\ than\ or\ equal\ to\ two\ are}
\DoxyCodeLine{intended\ for\ application\ configuration\ data\ and\ entry\ of\ this\ data}
\DoxyCodeLine{requires\ the\ entry\ of\ an\ address\ followed\ by\ entry\ of\ the\ value\ to\ be}
\DoxyCodeLine{stored\ at\ this\ address.}
\DoxyCodeLine{}
\DoxyCodeLine{When\ an\ address\ is\ entered,\ the\ transmit\ LED\ will\ flash\ rapidly}
\DoxyCodeLine{indicating\ that\ the\ system\ is\ waiting\ for\ entry\ of\ a\ data\ value.}
\DoxyCodeLine{If\ a\ data\ value\ is\ not\ entered\ within\ one\ minute\ the\ data\ entry\ protocol}
\DoxyCodeLine{will\ self-\/cancel\ (the\ transmit\ LED\ will\ stop\ flashing).}
\DoxyCodeLine{}
\DoxyCodeLine{In\ ```NOP100.cpp```\ the\ configuration\ process\ is\ handled\ by\ the}
\DoxyCodeLine{```prgButtonHandler(bool\ \_state\_,\ int\ \_value\_)```\ function\ which\ is}
\DoxyCodeLine{called\ each\ time\ the\ PRG\ button\ is\ operated.}
\DoxyCodeLine{*state*\ will\ be\ true\ if\ the\ PRG\ button\ has\ been\ released\ or\ false\ if}
\DoxyCodeLine{the\ PRG\ button\ has\ been\ pressed.}
\DoxyCodeLine{In\ either\ case,\ *value*\ will\ be\ set\ to\ the\ current\ value\ read\ from\ the}
\DoxyCodeLine{DIL\ switch.}
\DoxyCodeLine{}
\DoxyCodeLine{You\ can\ override\ NOP100's\ built-\/in\ behaviour\ by\ overriding\ the\ button}
\DoxyCodeLine{handler\ in\ ```module-\/declarations.inc```.}
\DoxyCodeLine{For\ example,\ the\ following\ code\ disables\ configuration\ entirely:}

\end{DoxyCode}
 \#define PRG\+\_\+\+BUTTON\+\_\+\+HANDLER void prg\+Button\+Handler(bool state, int value) \{ return; \} 
\begin{DoxyCode}{0}
\DoxyCodeLine{\#\#\ HOW\ TO}
\DoxyCodeLine{}
\DoxyCodeLine{1.\ Create\ parent\ folder\ for\ your\ new\ application.}

\end{DoxyCode}
 \$\texorpdfstring{$>$}{>} mkdir n2k-\/projects \$\texorpdfstring{$>$}{>} cd n2k-\/projects 
\begin{DoxyCode}{0}
\DoxyCodeLine{2.\ Clone\ a\ copy\ of\ the\ Arduino\ firmware\ build\ project\ and\ this}
\DoxyCodeLine{\ \ \ project\ into\ separate\ sub-\/folders.}

\end{DoxyCode}
 \$\texorpdfstring{$>$}{>} git clone \href{https://github.com/preeve9534/firmware-factory}{\texttt{ https\+://github.\+com/preeve9534/firmware-\/factory}} \$\texorpdfstring{$>$}{>} git clone \href{https://github.com/preeve9534/NOP100}{\texttt{ https\+://github.\+com/preeve9534/\+NOP100}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{3.\ Make\ a\ directory\ for\ your\ new\ project\ and\ populate\ it.}

\end{DoxyCode}
 \$\texorpdfstring{$>$}{>} mkdir myapp \$\texorpdfstring{$>$}{>} cd myapp \$\texorpdfstring{$>$}{>} cp ../\+NOP100/\+NOP100.cpp myapp.\+cpp \$\texorpdfstring{$>$}{>} cp ../\+NOP100/$\ast$.inc . \$\texorpdfstring{$>$}{>} cd .. 
\begin{DoxyCode}{0}
\DoxyCodeLine{You\ can\ now\ delete\ the\ NOP100\ project.}

\end{DoxyCode}
 rm -\/rf NOP100 
\begin{DoxyCode}{0}
\DoxyCodeLine{4.\ Set\ up\ the\ build\ environment\ so\ that\ it\ points\ to\ your\ new}
\DoxyCodeLine{\ \ \ project.}

\end{DoxyCode}
 \$\texorpdfstring{$>$}{>} cd firmware-\/factory/sketch \$\texorpdfstring{$>$}{>} rm src \$\texorpdfstring{$>$}{>} ln -\/s ../../myapp src \$\texorpdfstring{$>$}{>} cd ../.. \`{}\`{}\`{} At this juncture you should be able to open the firmware-\/factory project in your preferred build environment (I use Code) and compile a firmware for your application which does nothing. Well, not very much.
\begin{DoxyEnumerate}
\item Edit the {\ttfamily .inc} files downloaded at (3) to tailor and extend the module firmware to the requirements of your application. DO NOT MODIFY myapp.\+cpp. 
\end{DoxyEnumerate}